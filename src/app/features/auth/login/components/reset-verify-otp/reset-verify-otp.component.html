<div class="otp-container">
  <!-- Logo Section -->
  <app-auth-logo></app-auth-logo>

  <!-- OTP Card -->
  <div class="form-card">
    <!-- Lock Icon -->
    <div class="lock-icon-container">
      <div class="lock-icon">
        <mat-icon>lock</mat-icon>
      </div>
    </div>

    <div class="card-header">
      <h2>Enter Verification Code</h2>
      <p>We've sent a 6-digit code to your email</p>
      @if (email$ | async; as email) {
        <p class="email-display">{{ email }}</p>
      }
    </div>

    <!-- Error Message -->
    @if (error$ | async; as error) {
      <div class="error-message">
        <mat-icon>error_outline</mat-icon>
        <span>{{ error }}</span>
      </div>
    }

    <!-- OTP Input Fields -->
    <div class="otp-inputs" (paste)="onPaste($event)">
      @for (digit of otpDigits(); track $index) {
        <input
          type="text"
          inputmode="numeric"
          maxlength="1"
          [id]="'otp-' + $index"
          [value]="digit"
          (input)="onDigitInput($event, $index)"
          (keydown)="onKeyDown($event, $index)"
          class="otp-input"
          [class.filled]="digit !== ''"
        />
      }
    </div>

    <!-- Timer -->
    <div class="timer">
      <span>Code expires in </span>
      <span class="time">{{ formattedTime() }}</span>
    </div>

    <!-- Submit Button -->
    <div class="form-actions">
      <button
        mat-flat-button
        type="button"
        class="submit-btn"
        [disabled]="!isComplete() || (isLoading$ | async)"
        (click)="onSubmit()"
      >
        @if (isLoading$ | async) {
          <mat-spinner diameter="20"></mat-spinner>
        } @else {
          <ng-container>
            <mat-icon>check_circle</mat-icon>
            <span>Verify Code</span>
          </ng-container>
        }
      </button>
    </div>

    <!-- Resend Link -->
    <div class="resend-section">
      <span>Didn't receive the code?</span>
      <button
        mat-button
        class="resend-btn"
        [disabled]="!canResend() || (isLoading$ | async)"
        (click)="resendOtp()"
      >
        Resend Code
      </button>
    </div>
  </div>
</div>
